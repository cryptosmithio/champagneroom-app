{
  "id": "pCall Machine",
  "initial": "unclaimed",
  "states": {
    "unclaimed": {
      "on": {
        "claim": {
          "target": "claimed"
        },
        "request cancel": {
          "target": "cancelled"
        }
      }
    },
    "claimed": {
      "initial": "unfunded",
      "states": {
        "unfunded": {
          "on": {
            "transaction": [
              {
                "cond": "fundedAmount + transactionAmount >= Amount",
                "target": "ready for call"
              },
              {
                "target": "partially funded"
              }
            ],
            "request cancel": {
              "target": "#pCall Machine.cancelled"
            }
          }
        },
        "ready for call": {
          "on": {
            "call": {
              "target": "in progress"
            },
            "request cancel": {
              "actions": "refund",
              "cond": "funded",
              "target": "#pCall Machine.cancelled"
            }
          }
        },
        "partially funded": {
          "on": {
            "transaction": [
              {
                "cond": "fundedAmount + transactionAmount >= Amount",
                "target": "ready for call"
              },
              {}
            ],
            "request cancel": {
              "actions": "refund",
              "cond": "funded",
              "target": "#pCall Machine.cancelled"
            }
          }
        },
        "in progress": {
          "on": {
            "call interupted": {},
            "complete call": {
              "target": "#pCall Machine.waiting for finalization"
            }
          }
        }
      }
    },
    "cancelled": {
      "type": "final"
    },
    "finalized": {
      "type": "final"
    },
    "waiting for finalization": {
      "initial": "waiting on escrow",
      "states": {
        "waiting on escrow": {
          "on": {
            "give feedback": {
              "target": "#pCall Machine.finalized"
            },
            "escrow time completed": {
              "target": "#pCall Machine.finalized"
            },
            "dispute raised": {
              "target": "disputed"
            }
          }
        },
        "disputed": {
          "on": {
            "arbitrated": [
              {
                "actions": "refund",
                "cond": "approved",
                "target": "#pCall Machine.finalized"
              },
              {
                "actions": "no refund",
                "cond": "denied",
                "target": "#pCall Machine.finalized"
              }
            ]
          }
        }
      }
    }
  }
}